<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Jobcenter Letter Control</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css?v=200" />
</head>

<body>
  <div class="container">
    <div class="header">
      <div class="badge">Telegram Mini App · MVP</div>
      <h1 id="title">Проверка письма Jobcenter</h1>
      <p id="subtitle" class="subtitle">Помогаем понять, требуется ли действие по письму.</p>
    </div>

    <div class="card">
      <p id="disclaimer" class="disclaimer">
        Это не юридическая консультация. Сервис показывает только: нужно ли действие по письму.
      </p>

      <div class="actionsRow">
        <button id="cameraBtn" class="btn" type="button">Сделать фото</button>
        <button id="filesBtn" class="btn" type="button">Выбрать файлы</button>
      </div>

      <div class="smallNote">
        <b>Важно:</b> PDF в Telegram Mini App часто не обрабатывается. Для надёжного результата используйте фото/скрин страниц письма.<br>
        <b>Лимит:</b> максимум <span id="maxPagesText">15</span> страниц за один анализ.
      </div>

      <input id="cameraInput" type="file" accept="image/*" capture="environment" style="display:none" />
      <input id="filesInput"  type="file" accept="image/*" multiple style="display:none" />

      <!-- Карусель -->
      <div id="carouselWrap" class="carouselWrap">
        <div class="carouselHeader">
          <div class="chip" id="pagesCount">Добавлено: 0</div>
          <div class="chip" id="pageIndex">Страница: 0 / 0</div>
        </div>
        <div id="carousel" class="carousel"></div>
      </div>

      <!-- Подсказка при 0 страниц -->
      <div id="zeroHint" class="hintBox">
        Для анализа, пожалуйста, добавьте файл.
      </div>

      <!-- Подсказка при превышении лимита -->
      <div id="limitHint" class="hintBox">
        Достигнут лимит страниц для одного анализа. Добавьте меньше страниц или сделайте второй анализ.
      </div>

      <!-- Панель качества (BAD/WARN) -->
      <div id="qualityPanel" class="panel">
        <div id="qualityTitle" class="panelTitle"></div>
        <div id="qualityText" class="panelText"></div>

        <div class="panelActions">
          <button id="showBadBtn" class="btn" type="button">Показать нечитаемые</button>
          <button id="deleteCurrentBadBtn" class="btn" type="button">Удалить текущую bad страницу</button>
          <button id="deleteBadBtn" class="btn" type="button">Удалить нечитаемые</button>
          <button id="showWarnBtn" class="btn" type="button">Показать частично распознанные</button>
        </div>

        <div class="smallNote">
          Если страницы помечены как нечитаемые — анализ блокируется, чтобы результат был точным.
          Частично распознанные страницы анализ не блокируют, но могут снижать точность.
        </div>

        <div id="qualityList" class="pageList"></div>
      </div>

      <!-- Кнопка запуска -->
      <button id="analyzeBtn" class="btnPrimary" type="button" disabled>
        Готово → Анализ
      </button>

      <!-- Прогресс -->
      <div id="progressBox" class="progressBox">
        <div class="progressRow">
          <div class="ring" aria-hidden="true"></div>
          <div class="progressText">
            <div id="pLine1" class="t1">Анализ идёт</div>
            <div id="pLine2" class="t2">Контролируем содержание письма</div>
          </div>
        </div>
        <div id="lockNote" class="lockNote">
          Во время анализа добавление и удаление страниц временно недоступны.
        </div>
      </div>

      <!-- Результат -->
      <div id="resultBox" class="panel">
        <div id="doneBanner" class="doneBanner">
          <div class="doneTitle">Анализ завершён</div>
          <div class="doneSub">Ниже — результат проверки письма</div>
        </div>

        <div id="resultTitle" class="panelTitle"></div>
        <div id="resultSupport" class="panelText" style="margin-bottom:10px;"></div>
        <div id="resultDetails" class="panelText"></div>

        <div class="sectionDivider"></div>

        <div class="panelTitle">Кратко о письме</div>
        <div id="aboutText" class="panelText"></div>

        <div class="sectionDivider"></div>

        <div class="panelTitle">Перевод (следующий этап)</div>
        <div class="panelText">
          Независимо от результата мы добавим понятный перевод и объяснение письма.
          Это будет подключено на следующем этапе через AI (после стабилизации входа и многостраничности).
        </div>
      </div>

      <small class="version">
        v2.0 · modular split · main.js orchestrator
      </small>
    </div>
  </div>

  <!-- 1) Telegram Mini App SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- 2) Tesseract.js -->
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js?v=200"></script>

  <!-- 3) Your modules (order matters) -->
  <!-- Если у тебя названия чуть другие — оставь порядок, но подставь свои имена -->
  <script src="./config.js?v=200"></script>
  <script src="./state.js?v=200"></script>
  <script src="./dom.js?v=200"></script>
  <script src="./ui-carousel.js?v=200"></script>
  <script src="./ui-quality.js?v=200"></script>
  <script src="./image-pipeline.js?v=200"></script>
  <script src="./ocr.js?v=200"></script>
  <script src="./analysis.js?v=200"></script>

  <!-- 4) Orchestrator -->
  <script src="./main.js?v=200"></script>
</body>
</html>
