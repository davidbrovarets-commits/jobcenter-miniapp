<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Jobcenter Letter Control</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="./style.css?v=212" />

  <style>
    /* iOS/Telegram: НЕ display:none */
    .fileInputNative {
      position: absolute;
      left: -9999px;
      top: 0;
      width: 1px;
      height: 1px;
      opacity: 0.01;
    }

    /* label выглядит как кнопка (используем твои .btn стили) */
    .btnLabel {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      user-select: none;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header">
      <div class="badge">Telegram Mini App · MVP</div>
      <h1 id="title">Проверка письма Jobcenter</h1>
      <p id="subtitle" class="subtitle">Помогаем понять, требуется ли действие по письму.</p>
    </div>

    <div class="card">
      <p id="disclaimer" class="disclaimer">
        Это не юридическая консультация. Сервис показывает только: нужно ли действие по письму.
      </p>

      <!-- Нативные input -->
      <input id="cameraInput" class="fileInputNative" type="file" accept="image/*" capture="environment" />
      <input id="filesInput"  class="fileInputNative" type="file" accept="image/*" multiple />

      <!-- Вместо кнопок: LABEL (нативный триггер) -->
      <div class="actionsRow">
        <label id="cameraBtn" class="btn btnLabel" for="cameraInput" role="button" tabindex="0">
          Сделать фото
        </label>

        <label id="filesBtn" class="btn btnLabel" for="filesInput" role="button" tabindex="0">
          Выбрать файлы
        </label>
      </div>

      <div class="smallNote">
        <b>Важно:</b> PDF в Telegram Mini App часто не обрабатывается. Для надёжного результата используйте фото/скрин страниц письма.<br>
        <b>Лимит:</b> максимум <span id="maxPagesText">15</span> страниц за один анализ.
      </div>

      <!-- Карусель -->
      <div id="carouselWrap" class="carouselWrap">
        <div class="carouselHeader">
          <div class="chip" id="pagesCount">Добавлено: 0</div>
          <div class="chip" id="pageIndex">Страница: 0 / 0</div>
        </div>
        <div id="carousel" class="carousel"></div>
      </div>

      <div id="zeroHint" class="hintBox">Для анализа, пожалуйста, добавьте файл.</div>
      <div id="limitHint" class="hintBox">
        Достигнут лимит страниц для одного анализа. Добавьте меньше страниц или сделайте второй анализ.
      </div>

      <div id="qualityPanel" class="panel">
        <div id="qualityTitle" class="panelTitle"></div>
        <div id="qualityText" class="panelText"></div>

        <div class="panelActions">
          <button id="showBadBtn" class="btn" type="button">Показать нечитаемые</button>
          <button id="deleteCurrentBadBtn" class="btn" type="button">Удалить текущую bad страницу</button>
          <button id="deleteBadBtn" class="btn" type="button">Удалить нечитаемые</button>
          <button id="showWarnBtn" class="btn" type="button">Показать частично распознанные</button>
        </div>

        <div class="smallNote">
          Если страницы помечены как нечитаемые — анализ блокируется, чтобы результат был точным.
          Частично распознанные страницы анализ не блокируют, но могут снижать точность.
        </div>

        <div id="qualityList" class="pageList"></div>
      </div>

      <button id="analyzeBtn" class="btnPrimary" type="button" disabled>Готово → Анализ</button>

      <div id="progressBox" class="progressBox">
        <div class="progressRow">
          <div class="ring" aria-hidden="true"></div>
          <div class="progressText">
            <div id="pLine1" class="t1">Анализ идёт</div>
            <div id="pLine2" class="t2">Контролируем содержание письма</div>
          </div>
        </div>
        <div id="lockNote" class="lockNote">
          Во время анализа добавление и удаление страниц временно недоступны.
        </div>
      </div>

      <div id="resultBox" class="panel">
        <div id="doneBanner" class="doneBanner">
          <div class="doneTitle">Анализ завершён</div>
          <div class="doneSub">Ниже — результат проверки письма</div>
        </div>

        <div id="resultTitle" class="panelTitle"></div>
        <div id="resultSupport" class="panelText" style="margin-bottom:10px;"></div>
        <div id="resultDetails" class="panelText"></div>

        <div class="sectionDivider"></div>

        <div class="panelTitle">Кратко о письме</div>
        <div id="aboutText" class="panelText"></div>

        <div class="sectionDivider"></div>

        <div class="panelTitle">Перевод (следующий этап)</div>
        <div class="panelText">
          Независимо от результата мы добавим понятный перевод и объяснение письма.
          Это будет подключено на следующем этапе через AI (после стабилизации входа и многостраничности).
        </div>
      </div>

      <small class="version">v2.12 · iOS native label→input picker</small>
    </div>
  </div>

  <!-- 1) Telegram -->
  <script defer src="https://telegram.org/js/telegram-web-app.js"></script>
  <!-- 2) Tesseract -->
  <script defer src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js?v=212"></script>

  <!-- 3) Modules (order matters) -->
  <script defer src="./config.js?v=212"></script>
  <script defer src="./state.js?v=212"></script>
  <script defer src="./dom.js?v=212"></script>
  <script defer src="./ui-carousel.js?v=212"></script>
  <script defer src="./ui-quality.js?v=212"></script>
  <script defer src="./image-pipeline.js?v=212"></script>
  <script defer src="./ocr.js?v=212"></script>
  <script defer src="./analysis.js?v=212"></script>

  <!-- 4) main -->
  <script defer src="./main.js?v=212"></script>
</body>
</html>
