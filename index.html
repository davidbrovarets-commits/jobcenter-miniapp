<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Jobcenter Letter Control</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="app">
    <h1 id="title">Проверка письма Jobcenter</h1>
    <p id="subtitle">Помогаем понять, требуется ли действие по письму.</p>

    <div class="card">
      <h3 id="chooseLang">Выберите язык</h3>

      <div class="lang-buttons">
        <button id="btnRu" type="button">RU Русский</button>
        <button id="btnUa" type="button">UA Українська</button>
      </div>

      <p id="disclaimer">
        Это не юридическая консультация. Сервис показывает только: нужно ли действие по письму.
      </p>

      <button id="uploadBtn" class="btn" type="button">Загрузить письмо</button>
      <input id="fileInput" type="file" accept="application/pdf,image/*" style="display:none" />

      <div id="fileInfo" style="margin-top:10px; opacity:0.95;"></div>

      <!-- Pildi eelvaade -->
      <img id="imagePreview" alt="" style="display:none; margin-top:10px; width:100%; border-radius:12px;" />

      <!-- Teated / debug -->
      <pre id="rawText" style="margin-top:10px; white-space:pre-wrap;"></pre>

      <p class="hint" id="hint">
        Сейчас это демо-экран. Следующий шаг — подключить загрузку файла и анализ.
      </p>
    </div>

    <small class="version">v0.5 · File type detect + image preview</small>
  </div>

  <!-- Telegram Mini App SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <script>
    // Telegram Mini App init (safe)
    const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
    if (tg) {
      tg.ready();
      tg.expand();
    }

    const TEXTS = {
      ru: {
        title: "Проверка письма Jobcenter",
        subtitle: "Помогаем понять, требуется ли действие по письму.",
        chooseLang: "Выберите язык",
        disclaimer:
          "Это не юридическая консультация. Сервис показывает только: нужно ли действие по письму.",
        hint:
          "Шаг 2: определяем тип файла (PDF/картинка). Следующий шаг — извлечь текст (OCR/parse).",
        upload: "Загрузить письмо",
        fileInfo: (name, kb, type) => `Файл: ${name} (${kb} KB) · Тип: ${type}`,
        pickedPdf: "✅ PDF выбран. Следующий шаг — извлечение текста из PDF (parse/OCR).",
        pickedImage: "✅ Изображение выбрано. Показан предпросмотр. Следующий шаг — OCR.",
        unknownType: "⚠️ Неизвестный тип файла. Попробуйте PDF или изображение."
      },
      ua: {
        title: "Перевірка листа Jobcenter",
        subtitle: "Допомагаємо зрозуміти, чи потрібна дія за листом.",
        chooseLang: "Оберіть мову",
        disclaimer:
          "Це не юридична консультація. Сервіс показує лише: чи потрібна дія за листом.",
        hint:
          "Крок 2: визначаємо тип файлу (PDF/зображення). Далі — витяг тексту (OCR/parse).",
        upload: "Завантажити лист",
        fileInfo: (name, kb, type) => `Файл: ${name} (${kb} KB) · Тип: ${type}`,
        pickedPdf: "✅ PDF обрано. Далі — витяг тексту з PDF (parse/OCR).",
        pickedImage: "✅ Зображення обрано. Показано попередній перегляд. Далі — OCR.",
        unknownType: "⚠️ Невідомий тип файлу. Спробуйте PDF або зображення."
      }
    };

    let currentLang = "ru";

    function setLang(lang) {
      currentLang = lang;
      document.documentElement.lang = lang;

      document.getElementById("title").textContent = TEXTS[lang].title;
      document.getElementById("subtitle").textContent = TEXTS[lang].subtitle;
      document.getElementById("chooseLang").textContent = TEXTS[lang].chooseLang;
      document.getElementById("disclaimer").textContent = TEXTS[lang].disclaimer;
      document.getElementById("hint").textContent = TEXTS[lang].hint;
      document.getElementById("uploadBtn").textContent = TEXTS[lang].upload;
    }

    // DOM
    const btnRu = document.getElementById("btnRu");
    const btnUa = document.getElementById("btnUa");
    const uploadBtn = document.getElementById("uploadBtn");
    const fileInput = document.getElementById("fileInput");
    const fileInfo = document.getElementById("fileInfo");
    const rawText = document.getElementById("rawText");
    const imagePreview = document.getElementById("imagePreview");

    // Events
    btnRu.addEventListener("click", () => setLang("ru"));
    btnUa.addEventListener("click", () => setLang("ua"));

    uploadBtn.addEventListener("click", () => fileInput.click());

    fileInput.addEventListener("change", () => {
      // reset UI
      fileInfo.textContent = "";
      rawText.textContent = "";
      imagePreview.style.display = "none";
      imagePreview.src = "";
      imagePreview.alt = "";

      const file = fileInput.files && fileInput.files[0];
      if (!file) return;

      const kb = Math.round(file.size / 1024);
      const mime = (file.type || "").toLowerCase();

      // Kas PDF?
      const isPdf = mime === "application/pdf" || file.name.toLowerCase().endsWith(".pdf");
      // Kas pilt?
      const isImage = mime.startsWith("image/");

      let typeLabel = mime ? mime : "unknown";

      fileInfo.textContent = TEXTS[currentLang].fileInfo(file.name, kb, typeLabel);

      if (isPdf) {
        rawText.textContent = TEXTS[currentLang].pickedPdf;
        return;
      }

      if (isImage) {
        // image preview
        const url = URL.createObjectURL(file);
        imagePreview.src = url;
        imagePreview.alt = file.name;
        imagePreview.style.display = "block";

        rawText.textContent = TEXTS[currentLang].pickedImage;
        return;
      }

      rawText.textContent = TEXTS[currentLang].unknownType;
    });

    // init
    setLang("ru");
  </script>
</body>
</html>
